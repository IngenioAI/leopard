# Docker Web API 목록

## 이미지 관리 API

### 이미지 생성

```jsx
POST /api/image/create
```

지정된 데이터로 새로운 이미지를 생성한다.

POST시 body에 아래와 같은 데이터로 구성된 json 객체를 전달해야 한다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| name | string | 생성할 이미지의 이름을 지정한다 |
| baseImage | string | 기본으로 사용할 Docker 이미지의 Tag를 지정한다 |
| update | boolean | 기본 이지미에 apt update && apt upgrade 명령을 수행할지 여부를 지정한다 |
| aptInstall | string | apt install 명령어로 추가로 설치할 패키지를 문자열로 지정한다. 패키지는 빈칸으로 구분하여 하나의 문자열로 넘겨준다 |
| pipInstall | string | pip install 명령어로 추가로 설치할 패키지를 문자열로 지정한다. 패키지는 빈칸으로 구분하여 하나의 문자열로 넘겨준다 |
| additionalCommand | string | 패키지 설치후 추가로 입력할 명령어를 지정한다. 명령어는 ‘\n’으로 구분하여 하나의 문자열로 넘겨준다. |

결과로 json 객체를 리턴하며 해당 객체는 success 필드값을 boolean으로 가진다.  리턴은 생성이 완료되기를 기다리지 않고 생성 프로세스를 시작하면 바로 리턴한다. 이후 생성 과정을 모니터링 하기 위해서는 해당 이미지 이름을 이용하여 생성 정보 얻기 API를 사용한다.

### 이미지 생성 정보 얻기

```jsx
GET /api/image/create/{name}
```

생성중인 이미지의 정보를 얻는다. URL의 파라메터 name에는 생성하는 이미지의 이름을 지정하면 된다.

결과로 json 객체를 리턴하며 다음과 같은 데이터를 가진다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| status | string | 이미지 생성 프로세스의 실행 상태로 ‘running’ 또는 ‘exited’ 상태 중의 하나의 값을 가진다. |
| lines | [string] | 이미지 생성 프로세스의 출력을 문자열의 리스트로 가진다. |

### 이미지 생성 정보 삭제

```jsx
DELETE /api/image/create/{name}
```

생성중인 이미지의 정보를 삭제한다. URL의 파라메터 name에는 생성하는 이미지의 이름을 지정하면 된다.

이미지 생성이 완료되 경우 (이미지 생성 정보를 얻었을때 status가 exited인 경우) 더 이상 해당 생성 과정을 모니터링하지 않으려는 경우에 호출한다. 이를 통해서 서버가 해당 이미지 생성 과정에 대한 데이터를 더 이상 유지하지 않게 해준다.

해당 API의 호출이 이미지 생성 과정을 중단하게 하지는 않는다.

추후 DB를 통해서 이미지 관련 정보를 저장하게 한다면 사용법이 달라질 수 있다.

### 이미지 목록 얻기

```jsx
GET /api/image/list 
```

생성된 이미지의 목록을 얻는다.

결과로 json 객체의 배열을 리턴하며 각 객체는 docker-py에서 유지하는 모든 데이터를 포함한다. 그중 주요한 필드는 다음과 같다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| RepoTag | [string] | 이미지의 태그 이름 |
| Created | number | 생성된 시간 (Unix timestamp, 초단위) |
| Id | string | 이미지의 id |
| Size | number | 이미지의 크기, 바이트수 |

## 실행 관리 API

### 실행 수행

```jsx
POST /api/exec
```

새로운 실행을 시작한다.

POST시 body에 아래와 같은 데이터로 구성된 json 객체를 전달해야 한다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| srcPath | string | 실행할 소스코드가 위한 곳의 경로를 지정한다. 실행 컨테이너에서는 ‘/app’ 위치로 마운팅된다. |
| mainSrc | string | 소스코드에서 실행할 파이썬 메인 소스 파일을 지정한다. |
| imageTag | string | 실행할 이미지의 이름을 지정한다. |
| inputPath | string | 소스코드에서 참고할 input 데이터의 경로를 지정한다. 해당 경로는 소스코드에서 ‘./data’ 또는 ‘/app/data’로 참조할 수 있다. |
| outputPath | string | 소스코드에서 참고할 output 데이터의 경로를 지정한다. 해당 경로는 소스코드에서 ‘./output’ 또는 ‘/app/output’으로 참조할 수 있다. |

결과로 json 객체를 리턴하며 다음과 같은 데이터를 가진다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| exec_id | string | 새로 실행된 프로세스에 대한 id 값, 이 값을 통해 이후 상태 정보를 얻을 수 있다 |

### 실행 정보 얻기

```jsx
GET /api/exec/{exec_id}
```

실행 중인 프로세스의 정보를 얻는다. URL의 파라메터 exec_id에는 생성시에 리턴된 id값을 지정한다.

결과로 json 객체를 리턴하며, 객체는 docker-py에서 유지하는 모든 데이터를 포함한다. 그중 주요한 필드는 다음과 같다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| Args | [string] | 실행시에 커맨드 파라메터로 넘겨준 값의 목록 |
| Created | string | 실행 시작 시간으로 ISO문자열 형태 |
| Path | string | 실행 프로세스의 실행 파일 경로 |
| State.Running | boolean | 실행 중인지의 여부 |

### 실행 정보 삭제

```jsx
DELETE /api/exec/{exec_id}
```

실행 프로세스의 정보를 삭제한다. URL의 파라메터 exec_id에는 생성시에 리턴된 id값을 지정한다.

실행이 완료되 경우 (실행 정보를 얻었을때 State.Running이 false인 경우) 더 이상 해당 실행을 모니터링하지 않으려는 경우에 호출한다. 이를 통해서 서버가 해당 실행 과정에 대한 데이터를 더 이상 유지하지 않게 해준다.

해당 API의 호출이 실행을 중단하게 하지는 않는다.

추후 DB를 통해서 실행 관련 정보를 저장하게 한다면 사용법이 달라질 수 있다.

### 실행 로그 얻기

```jsx
GET /api/exec/logs/{exec_id}
```

실행 프로세스의 출력 로그를 얻는다. URL의 파라메터 name에는 생성하는 이미지의 이름을 지정하면 된다.

결과로 json 객체를 리턴하며 다음과 같은 데이터를 가진다.

| 필드이름 | 필드타입 | 설명 |
| --- | --- | --- |
| lines | [string] | 실행 프로세스의 출력을 문자열의 리스트로 가진다. |